# Kafka를 활용한 SAGA 패턴 기반 분산트랜잭션 구현

이 프로젝트에서는 MSA 환경에서 서로 다른 모듈간 데이터 일관성을 보장하는 SAGA 패턴 기반의 분산 트랜잭션을 구현하는 미니프로젝트를 진행하고 이를 정리했습니다.

프로젝트 진행과정은 아래 블로그에 자세히 정리되어 있습니다.
https://turtledev.tistory.com/73

---

### 실행 방법
docker가 실행된 상태에서, root 디렉토리에서 아래 명령어 실행
~~~
./start.sh
~~~
---
### 기술 스택
- Spring Boot 3.4.1
- Spring Data JPA
- Java 17
- Kafka
- MySql 8.0
---
### 주요 구현 사항
1. 주문, 재고, 결제 모듈별 기능 구현
2. SAGA 패턴(Choreography) 기반 모듈간 이벤트 처리 및 보상 트랜잭션 처리
3. Docker-Compose 기반 인프라 환경 구축

### 사용자 요청에 따른 트랜잭션 처리
**주문(Order Service)**
- 주문 모듈은 사용자의 주문 상품 ID 리스트를 포함한 요청 수신
- 서버에서는 상품 ID를 통해 상품 정보를 조회한 후, 주문 정보를 보류(PENDING)상태로 DB에 저장
- 이후 재고 정보 확인을 위해 재고 모듈을 대상으로 주문정보를 담은 재고 확인 요청 이벤트 발행

**재고(Inventory Service)**

- 재고 모듈은 주문 요청 토픽에 발행된 이벤트를 확인하여, 주문 요청 상품의 재고가 충분한지 확인  
- 재고 충분 -> 재고에 대한 임시 차감을 해두고 결제 모듈에 결제 요청 이벤트 발행  
- 재고 불충분 -> 주문 모듈로 보상트랜잭션 요청 이벤트 발행
- 
**결제(Payment Service)**
- 결제 모듈은 결제 요청 토픽에 발행된 이벤트를 확인하여, 결제 처리 
- 결제 성공 -> 주문 모듈과 재고 모듈에 결제 성공 이벤트를 발행하여 주문 상태 변경(APPROVED)와 재고 임시 차감을 확정  
- 결제 실패 -> 주문 모듈과 재고 모듈에 결제 실패 이벤트를 발행하여 주문 요청을 취소하고, 재고 임시 차감을 롤백  
---
### 인프라 구성
![Image](https://github.com/user-attachments/assets/29348fa3-eca6-4b89-af28-b191c7b31553)
